# QNWIS Service API - HTTP Request Examples
#
# Runnable HTTP samples for all QNWIS API endpoints.
# Use with VS Code REST Client, IntelliJ HTTP Client, or HTTPie.
#
# Version: 1.0.0 | Last Updated: 2025-11-10

### Variables
@baseUrl = http://localhost:8000
@apiKey = integration-key
@jwtToken = eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...

###############################################################################
# Health & Observability
###############################################################################

### Health - Liveness
GET {{baseUrl}}/health/alive

### Health - Readiness
GET {{baseUrl}}/health/ready

### Prometheus Metrics
GET {{baseUrl}}/metrics

### API Info
GET {{baseUrl}}/

###############################################################################
# Time Machine Agent
###############################################################################

### Time Baseline (API Key Auth)
POST {{baseUrl}}/api/v1/agents/time/baseline
Content-Type: application/json
X-API-Key: {{apiKey}}

{
  "intent": "time.baseline",
  "params": {
    "metric": "retention"
  },
  "options": {
    "enforce_citations": true,
    "verify_numbers": true,
    "audit_pack": true
  }
}

### Time Trend (JWT Auth)
POST {{baseUrl}}/api/v1/agents/time/trend
Content-Type: application/json
Authorization: Bearer {{jwtToken}}

{
  "intent": "time.trend",
  "params": {
    "metric": "retention"
  }
}

### Time Breaks
POST {{baseUrl}}/api/v1/agents/time/breaks
Content-Type: application/json
X-API-Key: {{apiKey}}

{
  "intent": "time.breaks",
  "params": {
    "metric": "retention"
  }
}

###############################################################################
# Pattern Miner Agent
###############################################################################

### Pattern Anomalies
POST {{baseUrl}}/api/v1/agents/pattern/anomalies
Content-Type: application/json
X-API-Key: {{apiKey}}

{
  "intent": "pattern.anomalies",
  "params": {
    "z_threshold": 2.0
  }
}

### Pattern Correlations
POST {{baseUrl}}/api/v1/agents/pattern/correlations
Content-Type: application/json
X-API-Key: {{apiKey}}

{
  "intent": "pattern.correlations",
  "params": {
    "min_correlation": 0.5
  }
}

###############################################################################
# Predictor Agent
###############################################################################

### Predictor Forecast
POST {{baseUrl}}/api/v1/agents/predictor/forecast
Content-Type: application/json
X-API-Key: {{apiKey}}

{
  "intent": "predictor.forecast",
  "params": {
    "metric": "retention",
    "horizon_months": 6
  }
}

### Predictor Warnings
POST {{baseUrl}}/api/v1/agents/predictor/warnings
Content-Type: application/json
X-API-Key: {{apiKey}}

{
  "intent": "predictor.warnings",
  "params": {
    "metric": "retention",
    "horizon_months": 3
  }
}

###############################################################################
# Scenario Planner Agent
###############################################################################

### Scenario Apply
POST {{baseUrl}}/api/v1/agents/scenario/apply
Content-Type: application/json
X-API-Key: {{apiKey}}

{
  "intent": "scenario.apply",
  "params": {
    "spec": {
      "name": "Retention Boost",
      "description": "5% retention increase",
      "metric": "retention",
      "sector": "Energy",
      "horizon_months": 12,
      "transforms": [
        {"type": "multiplicative", "value": 0.05, "start_month": 0}
      ]
    },
    "format": "dict"
  }
}

### Scenario Compare
POST {{baseUrl}}/api/v1/agents/scenario/compare
Content-Type: application/json
X-API-Key: {{apiKey}}

{
  "intent": "scenario.compare",
  "params": {
    "specs": [
      {
        "name": "Energy Push",
        "description": "Energy sector focus",
        "metric": "retention",
        "sector": "Energy",
        "horizon_months": 12,
        "transforms": [{"type": "multiplicative", "value": 0.05, "start_month": 0}]
      },
      {
        "name": "Construction Stabilize",
        "description": "Construction stabilization",
        "metric": "retention",
        "sector": "Construction",
        "horizon_months": 12,
        "transforms": [{"type": "additive", "value": 2.0, "start_month": 0}]
      }
    ],
    "format": "dict"
  }
}

###############################################################################
# National Strategy Agent
###############################################################################

### Strategy GCC Benchmark
POST {{baseUrl}}/api/v1/agents/strategy/benchmark
Content-Type: application/json
X-API-Key: {{apiKey}}

{
  "intent": "strategy.benchmark",
  "params": {
    "min_countries": 3
  }
}

### Strategy Vision Alignment
POST {{baseUrl}}/api/v1/agents/strategy/vision
Content-Type: application/json
X-API-Key: {{apiKey}}

{
  "intent": "strategy.vision",
  "params": {
    "target_year": 2030
  }
}

###############################################################################
# Error Cases
###############################################################################

### Error - Missing Auth (401)
POST {{baseUrl}}/api/v1/agents/time/baseline
Content-Type: application/json

{
  "intent": "time.baseline",
  "params": {"metric": "retention"}
}

### Error - Intent Mismatch (400)
POST {{baseUrl}}/api/v1/agents/time/baseline
Content-Type: application/json
X-API-Key: {{apiKey}}

{
  "intent": "time.trend",
  "params": {"metric": "retention"}
}

### Error - Missing Required Param (400)
POST {{baseUrl}}/api/v1/agents/scenario/apply
Content-Type: application/json
X-API-Key: {{apiKey}}

{
  "intent": "scenario.apply",
  "params": {}
}

###############################################################################
# Disaster Recovery & Backups (RG-7)
###############################################################################

### DR - Create Backup
# RBAC: admin, service
POST {{baseUrl}}/api/v1/dr/backup
Content-Type: application/json
X-API-Key: {{apiKey}}

{
  "spec": {
    "spec_id": "daily-backup-001",
    "tag": "daily",
    "datasets": ["LMIS_RETENTION_TS", "LMIS_SALARY_TS"],
    "audit_packs": true,
    "config": true,
    "storage_target": "local-prod",
    "encryption": "aes_256_gcm",
    "retention_days": 30
  },
  "storage_target_id": "local-prod",
  "key_id": "key-abc123"
}

### DR - List Snapshots
# RBAC: analyst, admin, service
GET {{baseUrl}}/api/v1/dr/snapshots?storage_target_id=local-prod&tag=daily
X-API-Key: {{apiKey}}

### DR - List Snapshots (Filter by Tag)
GET {{baseUrl}}/api/v1/dr/snapshots?storage_target_id=local-prod&tag=weekly
X-API-Key: {{apiKey}}

### DR - Verify Snapshot
# RBAC: admin, service
POST {{baseUrl}}/api/v1/dr/verify/snap-abc123
Content-Type: application/json
X-API-Key: {{apiKey}}

{
  "storage_target_id": "local-prod",
  "key_id": "key-abc123",
  "sample_count": 10
}

### DR - Restore Snapshot (Dry Run)
# RBAC: admin, service
POST {{baseUrl}}/api/v1/dr/restore
Content-Type: application/json
X-API-Key: {{apiKey}}

{
  "snapshot_id": "snap-abc123",
  "target_path": "/mnt/restore",
  "storage_target_id": "local-prod",
  "key_id": "key-abc123",
  "dry_run": true,
  "overwrite": false
}

### DR - Restore Snapshot (Execute)
# RBAC: admin, service
# WARNING: This will overwrite files in target_path if overwrite=true
POST {{baseUrl}}/api/v1/dr/restore
Content-Type: application/json
X-API-Key: {{apiKey}}

{
  "snapshot_id": "snap-abc123",
  "target_path": "/mnt/restore",
  "storage_target_id": "local-prod",
  "key_id": "key-abc123",
  "dry_run": false,
  "overwrite": true
}

### DR - Create Weekly Backup
POST {{baseUrl}}/api/v1/dr/backup
Content-Type: application/json
X-API-Key: {{apiKey}}

{
  "spec": {
    "spec_id": "weekly-backup-001",
    "tag": "weekly",
    "datasets": ["LMIS_RETENTION_TS", "LMIS_SALARY_TS", "LMIS_TURNOVER_TS"],
    "audit_packs": true,
    "config": true,
    "storage_target": "archive-storage",
    "encryption": "aes_256_gcm",
    "retention_days": 90
  },
  "storage_target_id": "archive-storage",
  "key_id": null
}

### DR - Create Monthly Compliance Backup (WORM)
POST {{baseUrl}}/api/v1/dr/backup
Content-Type: application/json
X-API-Key: {{apiKey}}

{
  "spec": {
    "spec_id": "monthly-compliance-001",
    "tag": "monthly",
    "datasets": ["LMIS_RETENTION_TS", "LMIS_SALARY_TS", "LMIS_TURNOVER_TS", "LMIS_SECTOR_STATS"],
    "audit_packs": true,
    "config": true,
    "storage_target": "worm-storage",
    "encryption": "aes_256_gcm",
    "retention_days": 365
  },
  "storage_target_id": "worm-storage",
  "key_id": "key-compliance-001"
}
